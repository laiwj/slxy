{"version":3,"sources":["webpack:///./src/modules/login/login.js"],"names":[],"mappings":";;;;;0GAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,cAAa;AACb;AACA;AACA,cAAa;AACb;AACA;AACA;AACA;AACA,cAAa;AACb;AACA;AACA;AACA,UAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,UAAS;AACT;AACA;AACA;AACA;AACA;AACA,cAAa;AACb,UAAS;AACT;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,sBAAqB;AACrB;AACA;;AAEA;AACA;AACA;AACA,yEAAwE,eAAe;AACvF;AACA;AACA;AACA,kBAAiB;AACjB;AACA;AACA;;AAEA;AACA;;AAEA;AACA,cAAa;AACb,UAAS;AACT;AACA,qEAAoE,eAAe;AACnF,UAAS;AACT;AACA;AACA,UAAS;AACT;AACA,+DAA8D,YAAY;AAC1E;AACA,MAAK;;;AAGL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA,MAAK;;;;AAIL,EAAC,gJ","file":"js/2.chunk.05b67535.js","sourcesContent":["define([], function(api) {\r\n    var validationVM\r\n        // 定义所有相关的 vmodel\r\n    var vm = avalon.define({\r\n        $id: \"login\",\r\n        isSumbit: false,\r\n        account: \"\",\r\n        password: null,\r\n        validation: {\r\n            onInit: function(v) {\r\n                validationVM = v;\r\n            },\r\n            onReset: function(e, data) {\r\n                $(\".alert-login\").text(\"\").hide();\r\n            },\r\n            onError: function(reasons) {\r\n                var str = reasons[0].message;\r\n                $(\".alert-login\").text(str).show();\r\n                $(\"#J_login\").attr(\"disabled\", true);\r\n            },\r\n            onSuccess: function() {\r\n                $(\"#J_login\").attr(\"disabled\", false);\r\n            }\r\n        },\r\n        initEditData: function() {\r\n            var userStr = vm.getPassFromCookie();\r\n            if (userStr) {\r\n                var userBean = userStr.split('|');\r\n                vm.account = userBean[0];\r\n                vm.password = userBean[1];\r\n                if (userBean[1]) {\r\n                    $('.J_password_remember').attr(\"checked\", \"checked\");\r\n                }\r\n            }\r\n\r\n        },\r\n        initDomListener: function() {\r\n            $(document).on('keydown', function(e) {\r\n                if (e.keyCode == 13) {\r\n                    $('#J_login').click();\r\n                }\r\n            });\r\n        },\r\n        loginFun: function() {\r\n            if (vm.isSumbit) {\r\n                return;\r\n            }\r\n            var passwordnot = $(\"#login_password\").val();\r\n\r\n            $(\"#J_login\").text(\"正在登录...\");\r\n            var bean = {\r\n                    \"account\": vm.account,\r\n                    \"password\": vm.password\r\n                }\r\n                //发送数据到后台\r\n            var url = \"/user/login\";\r\n            vm.isSumbit = true;\r\n            $.post(url, bean, function(jsonObj) {\r\n                vm.isSumbit = false;\r\n                $(\"#J_login\").text(\"登录\");\r\n                //登录失败\r\n                if (jsonObj.code !== 0) {\r\n                    $(\".alert-login\").text(jsonObj.msg).show();\r\n                    setTimeout(function() {\r\n                        $(\".alert-login\").hide();\r\n                    }, 1000);\r\n                    return false;\r\n                }\r\n\r\n                //登录成功\r\n                // 保存用户信息\r\n                var userInfo = jsonObj.data._id + \"|\" + jsonObj.data.type + \"|\" + jsonObj.data.short_id + \"|\" + jsonObj.data.username;\r\n                window.$.cookie(location.host + \"_userinfo\", userInfo, { expires: 365 });\r\n                var passInfo = jsonObj.data.username + \"|\" + jsonObj.data.password;\r\n                if (document.getElementById('J_password_remember').checked) {\r\n                    vm.savePassToCookie(passInfo);\r\n                } else {\r\n                    //清除cookie内明文密码\r\n                    vm.clearPassToCookie();\r\n                }\r\n\r\n                //清除上一次的用户信息\r\n                window.$.cookie(location.host + \"_userInfoResult\", \"\");\r\n\r\n                window.location.href = \"/#!/report\";\r\n            });\r\n        },\r\n        savePassToCookie: function(passInfo) {\r\n            window.$.cookie(location.host + \"_password\", passInfo, { expires: 365 });\r\n        },\r\n        getPassFromCookie: function() {\r\n            return window.$.cookie(location.host + \"_password\");\r\n        },\r\n        clearPassToCookie: function() {\r\n            window.$.cookie(location.host + \"_password\", \"\", { path: \"/\" });\r\n        }\r\n    });\r\n\r\n\r\n    return avalon.controller(function($ctrl) {\r\n        // 视图渲染后，意思是avalon.scan完成\r\n        $ctrl.$onRendered = function() {\r\n            // 定义title\r\n            document.title = '登录';\r\n            // 登录框信息的显示与否\r\n            vm.initEditData();\r\n            // 页面中元素时间监听\r\n            vm.initDomListener();\r\n\r\n        };\r\n\r\n        // 进入视图\r\n        $ctrl.$onEnter = function(param, rs, rj) {\r\n\r\n        };\r\n        // 对应的视图销毁前\r\n        $ctrl.$onBeforeUnload = function() {\r\n\r\n        };\r\n        $ctrl.$vmodels = [vm];\r\n    })\r\n\r\n\r\n\r\n});\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/modules/login/login.js\n// module id = 35\n// module chunks = 2"],"sourceRoot":""}